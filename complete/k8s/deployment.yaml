apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    autopilot.gke.io/resource-adjustment: '{"input":{"containers":[{"limits":{"ephemeral-storage":"1Gi"},"requests":{"cpu":"500m","ephemeral-storage":"1Gi","memory":"2Gi"},"name":"gs-rest-service"},{"name":"cloudsql-proxy"}]},"output":{"containers":[{"limits":{"ephemeral-storage":"1Gi"},"requests":{"cpu":"500m","ephemeral-storage":"1Gi","memory":"2Gi"},"name":"gs-rest-service"},{"limits":{"ephemeral-storage":"1Gi"},"requests":{"cpu":"500m","ephemeral-storage":"1Gi","memory":"2Gi"},"name":"cloudsql-proxy"}]},"computeClassAtAdmission":"Default","modified":true}'
    autopilot.gke.io/warden-version: 32.38.0-gke.2
    deployment.kubernetes.io/revision: "12"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"gs-rest-service","app.kubernetes.io/managed-by":"gcp-cloud-build-deploy"},"name":"gs-rest-service","namespace":"default"},"spec":{"replicas":2,"selector":{"matchLabels":{"app":"gs-rest-service"}},"template":{"metadata":{"labels":{"app":"gs-rest-service","app.kubernetes.io/managed-by":"gcp-cloud-build-deploy"}},"spec":{"containers":[{"env":[{"name":"SPRING_PROFILES_ACTIVE","value":"prod"},{"name":"DATASOURCE_URL","value":"jdbc:mysql://127.0.0.1:3306/service-db"},{"name":"DATASOURCE_USERNAME","valueFrom":{"secretKeyRef":{"key":"username","name":"db-credentials"}}},{"name":"DATASOURCE_PASSWORD","valueFrom":{"secretKeyRef":{"key":"password","name":"db-credentials"}}}],"image":"europe-west1-docker.pkg.dev/onyx-glider-460209-a9/gs-repository/gs-rest-service@sha256:b221c36f9d5fff3c85c049a278c0d9f14b8e90f40855ba84fd519416b94851a4","imagePullPolicy":"Always","name":"gs-rest-service","ports":[{"containerPort":8080}],"resources":{"limits":{"cpu":"250m","memory":"256Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"args":["--private-ip","--structured-logs","--credentials-file=/secrets/key.json","--port=3306","onyx-glider-460209-a9:europe-west1:rs-rest-service-db"],"image":"gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.8.0","name":"cloudsql-proxy","resources":{"limits":{"cpu":"250m","memory":"256Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/secrets","name":"cloudsql-instance-credentials","readOnly":true}]}],"volumes":[{"name":"cloudsql-instance-credentials","secret":{"secretName":"cloudsql-sa-credentials"}}]}}}}
  creationTimestamp: "2025-06-01T13:54:30Z"
  generation: 12
  labels:
    app: gs-rest-service
    app.kubernetes.io/managed-by: gcp-cloud-build-deploy
  managedFields:
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:labels:
            .: {}
            f:app: {}
        f:spec:
          f:progressDeadlineSeconds: {}
          f:revisionHistoryLimit: {}
          f:selector: {}
          f:strategy:
            f:rollingUpdate:
              .: {}
              f:maxSurge: {}
              f:maxUnavailable: {}
            f:type: {}
          f:template:
            f:metadata:
              f:labels:
                .: {}
                f:app: {}
            f:spec:
              f:containers:
                k:{"name":"gs-rest-service"}:
                  .: {}
                  f:name: {}
                  f:resources: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
              f:dnsPolicy: {}
              f:restartPolicy: {}
              f:schedulerName: {}
              f:securityContext: {}
              f:terminationGracePeriodSeconds: {}
      manager: kubectl-create
      operation: Update
      time: "2025-06-01T13:54:30Z"
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:spec:
          f:template:
            f:metadata:
              f:annotations:
                .: {}
                f:kubectl.kubernetes.io/restartedAt: {}
      manager: kubectl-rollout
      operation: Update
      time: "2025-06-01T14:27:36Z"
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            f:kubectl.kubernetes.io/last-applied-configuration: {}
          f:labels:
            f:app.kubernetes.io/managed-by: {}
        f:spec:
          f:replicas: {}
          f:template:
            f:metadata:
              f:labels:
                f:app.kubernetes.io/managed-by: {}
            f:spec:
              f:containers:
                k:{"name":"cloudsql-proxy"}:
                  .: {}
                  f:args: {}
                  f:image: {}
                  f:imagePullPolicy: {}
                  f:name: {}
                  f:resources:
                    .: {}
                    f:limits:
                      f:cpu: {}
                      f:memory: {}
                    f:requests:
                      f:cpu: {}
                      f:memory: {}
                  f:terminationMessagePath: {}
                  f:terminationMessagePolicy: {}
                  f:volumeMounts:
                    .: {}
                    k:{"mountPath":"/secrets"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                      f:readOnly: {}
                k:{"name":"gs-rest-service"}:
                  f:env:
                    .: {}
                    k:{"name":"DATASOURCE_PASSWORD"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"DATASOURCE_URL"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"DATASOURCE_USERNAME"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        .: {}
                        f:secretKeyRef: {}
                    k:{"name":"SPRING_PROFILES_ACTIVE"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                  f:image: {}
                  f:imagePullPolicy: {}
                  f:ports:
                    .: {}
                    k:{"containerPort":8080,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                  f:resources:
                    f:limits:
                      f:cpu: {}
                      f:memory: {}
                    f:requests:
                      f:cpu: {}
                      f:memory: {}
              f:volumes:
                .: {}
                k:{"name":"cloudsql-instance-credentials"}:
                  .: {}
                  f:name: {}
                  f:secret:
                    .: {}
                    f:defaultMode: {}
                    f:secretName: {}
      manager: kubectl-client-side-apply
      operation: Update
      time: "2025-06-02T19:09:31Z"
    - apiVersion: apps/v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            f:deployment.kubernetes.io/revision: {}
        f:status:
          f:conditions:
            .: {}
            k:{"type":"Available"}:
              .: {}
              f:lastTransitionTime: {}
              f:lastUpdateTime: {}
              f:message: {}
              f:reason: {}
              f:status: {}
              f:type: {}
            k:{"type":"Progressing"}:
              .: {}
              f:lastTransitionTime: {}
              f:lastUpdateTime: {}
              f:message: {}
              f:reason: {}
              f:status: {}
              f:type: {}
          f:observedGeneration: {}
          f:replicas: {}
          f:unavailableReplicas: {}
          f:updatedReplicas: {}
      manager: kube-controller-manager
      operation: Update
      subresource: status
      time: "2025-06-03T10:45:29Z"
  name: gs-rest-service
  namespace: default
  resourceVersion: "1748947529080255015"
  uid: e688aac6-319e-4336-aa56-5a280b3a4de2
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: gs-rest-service
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: "2025-06-01T14:27:36Z"
      creationTimestamp: null
      labels:
        app: gs-rest-service
        app.kubernetes.io/managed-by: gcp-cloud-build-deploy
    spec:
      containers:
        - env:
            - name: SPRING_PROFILES_ACTIVE
              value: prod
            - name: DATASOURCE_URL
              value: jdbc:mysql://127.0.0.1:3306/service-db
            - name: DATASOURCE_USERNAME
              valueFrom:
                secretKeyRef:
                  key: username
                  name: db-credentials
            - name: DATASOURCE_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: db-credentials
          image: europe-west1-docker.pkg.dev/onyx-glider-460209-a9/gs-repository/gs-rest-service@sha256:b221c36f9d5fff3c85c049a278c0d9f14b8e90f40855ba84fd519416b94851a4
          imagePullPolicy: Always
          name: gs-rest-service
          ports:
            - containerPort: 8080
              protocol: TCP
          resources:
            limits:
              cpu: 250m
              ephemeral-storage: 1Gi
              memory: 256Mi
            requests:
              cpu: 100m
              ephemeral-storage: 1Gi
              memory: 128Mi
          securityContext:
            capabilities:
              drop:
                - NET_RAW
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        - args:
            - --private-ip
            - --structured-logs
            - --credentials-file=/secrets/key.json
            - --port=3306
            - onyx-glider-460209-a9:europe-west1:rs-rest-service-db
          image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.8.0
          imagePullPolicy: IfNotPresent
          name: cloudsql-proxy
          resources:
            limits:
              cpu: 250m
              ephemeral-storage: 1Gi
              memory: 256Mi
            requests:
              cpu: 100m
              ephemeral-storage: 1Gi
              memory: 128Mi
          securityContext:
            capabilities:
              drop:
                - NET_RAW
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /secrets
              name: cloudsql-instance-credentials
              readOnly: true
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        seccompProfile:
          type: RuntimeDefault
      terminationGracePeriodSeconds: 30
      tolerations:
        - effect: NoSchedule
          key: kubernetes.io/arch
          operator: Equal
          value: amd64
      volumes:
        - name: cloudsql-instance-credentials
          secret:
            defaultMode: 420
            secretName: cloudsql-sa-credentials
status:
  conditions:
    - lastTransitionTime: "2025-06-02T19:07:39Z"
      lastUpdateTime: "2025-06-02T19:20:31Z"
      message: ReplicaSet "gs-rest-service-55b984654d" has successfully progressed.
      reason: NewReplicaSetAvailable
      status: "True"
      type: Progressing
    - lastTransitionTime: "2025-06-03T04:55:15Z"
      lastUpdateTime: "2025-06-03T04:55:15Z"
      message: Deployment does not have minimum availability.
      reason: MinimumReplicasUnavailable
      status: "False"
      type: Available
  observedGeneration: 12
  replicas: 2
  unavailableReplicas: 2
  updatedReplicas: 2
